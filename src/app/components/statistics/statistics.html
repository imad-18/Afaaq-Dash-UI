<!-- First dropdown: choose type -->
<nz-tabs>
  <!--Tab 1-->
  <nz-tab nzTitle="Statistics">
    <div style="margin-top: 30px;">
      <nz-table [nzBordered]="true" [nzSize]="'small'" style="max-width: 90%">
        <thead>
        <tr>
          <th>Campaign ID</th>
          <th>Campaign Title</th>
          <th>Statistic Id</th>
          <th>Year Edition</th>
          <th>Attributes</th>
        </tr>
        </thead>
        <tbody>
            @for (stat of statistics; track stat.id) {
              <tr>
                <td>{{ stat.compaignId }}</td>
                <td>{{ stat.compaignTitle }}</td>
                <td>{{ stat.id }}</td>
                <td>{{ stat.yearEdition | date:'yyyy-MM-dd' }}</td>
                <td>
                  <ul style="margin: 0; padding-left: 16px;">
                    @for (attr of stat.attributes; track attr.id) {
                      <li>{{ attr.attributeName }} : {{ attr.attributeValue }}</li>
                    }
                  </ul>
                </td>
              </tr>
            }
        </tbody>
      </nz-table>
    </div>

  </nz-tab>


  <!-- Tab 2-->
  <nz-tab nzTitle="Campaigns">
    <button nz-button nz-dropdown [nzDropdownMenu]="campaignsMenu">
      Select Campaign
      <nz-icon nzType="down"></nz-icon>
    </button>
    <!-- 2-b) Display the campaigns/activities titles-->
    <nz-dropdown-menu #campaignsMenu="nzDropdownMenu">
      <ul nz-menu>
        @for (item of campaigns; track item.id){
          <li nz-menu-item (click)="onSelectedItem(item)">{{item.title}}</li>
        }
      </ul>
    </nz-dropdown-menu>

    <!--Table of campaigns-->
    @if (selectedItem)
    {
      <div style="margin-top: 30px;">
        <nz-table [nzData]="campaigns" [nzBordered]="true" [nzSize]="'small'" style="max-width: 60%">
          <thead>
          <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Description</th>
          </tr>
          </thead>
          <tbody>
              <tr>
                <td>{{selectedItem.id}}</td>
                <td>{{selectedItem.title}}</td>
                <td>{{selectedItem.description}}</td>
              </tr>
          </tbody>
        </nz-table>
      </div>

      @if (hasStatistics){

      }

      <button nz-button nzType="primary" (click)="openStatisticForm()">
        {{hasStatistics? 'Add': 'Create'}} new statistic
      </button>

      <!-- Case 2: If no statistics exist, show dynamic form -->
      @if (isVisible && !hasStatistics){
        <div style="margin-top: 20px;">

          <form [formGroup]="statisticForm" (ngSubmit)="onSubmit()">

            <input type="date" formControlName="yearEdition" />

            <div formArrayName="attributes">
              @for (attr of attributes.controls; track $index) {
                <div [formGroupName]="$index" class="attribute-row">
                  <input nz-input placeholder="Attribute Name" formControlName="attributeName" style="width: 40%; margin-right: 10px;" />
                  <input nz-input placeholder="Attribute Value" formControlName="attributeValue" style="width: 40%; margin-right: 10px;" />
                  <button nz-button nzType="default" (click)="removeAttribute($index)" type="button">Remove</button>
                </div>
              }
            </div>

            <button nz-button nzType="dashed" (click)="addAttribute()" type="button" style="margin-top: 10px;">+ Add Attribute</button>

            <div style="margin-top: 15px;">
              <button nz-button nzType="primary" htmlType="submit">Save Statistic</button>
              <button nz-button nzType="default" type="button" (click)="cancelStatisticForm()" style="margin-left: 20px">Cancel</button>
            </div>
          </form>

        </div>
      }
    }

  </nz-tab>

  <!-- Tab 3 -->
  <nz-tab nzTitle="Activities">
    <button nz-button nz-dropdown [nzDropdownMenu]="acitivitiesMenu">
      Select Activity
      <nz-icon nzType="down"></nz-icon>
    </button>
    <!-- 2-b) Display the campaigns/activities titles-->
    <nz-dropdown-menu #acitivitiesMenu="nzDropdownMenu">
      <ul nz-menu>
        @for (activity of activities; track activity.id){
          <li nz-menu-item >{{activity.title}}</li>
        }
      </ul>
    </nz-dropdown-menu>
  </nz-tab>
</nz-tabs>







